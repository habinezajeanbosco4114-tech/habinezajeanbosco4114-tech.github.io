<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habineza Tech Academy - CSA & Trade</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Header */
        header {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 20px rgba(0,0,0,0.2);
        }

        .settings-corner {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            cursor: pointer;
            color: white;
            transition: all 0.3s;
        }

        .settings-corner:hover {
            transform: translateY(-50%) rotate(90deg);
            color: #3498db;
        }

        /* Navigation */
        nav {
            background: rgba(31, 45, 61, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 20px;
            border-radius: 25px;
            transition: all 0.3s;
            display: inline-block;
        }

        nav a:hover {
            background: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52,152,219,0.4);
        }

        nav a i {
            margin-right: 5px;
        }

        /* Container */
        .container {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            display: none;
        }

        .section-title {
            font-size: 32px;
            color: white;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* Cards */
        .card {
            background: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-left: 5px solid #3498db;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(52,152,219,0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        /* Forms */
        input, select {
            width: 100%;
            padding: 12px 15px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52,152,219,0.3);
        }

        /* Password field with toggle */
        .password-field {
            position: relative;
            width: 100%;
        }

        .password-field input {
            padding-right: 40px;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #666;
        }

        .toggle-password:hover {
            color: #3498db;
        }

        /* Profile picture */
        .profile-pic {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #3498db;
            margin: 10px auto;
            display: block;
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-pic:hover {
            transform: scale(1.05);
            border-color: #2980b9;
        }

        /* Timer */
        .exam-timer {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 20px 0;
        }

        /* Admin badge */
        .admin-badge {
            background: #e74c3c;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
        }

        /* User list */
        .user-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .user-row:last-child {
            border-bottom: none;
        }

        /* Completed notes */
        .completed-note {
            background: #e8f5e9;
            padding: 10px;
            margin: 5px 0;
            border-radius: 10px;
            border-left: 4px solid #27ae60;
        }

        /* Exam history */
        .exam-history-item {
            background: #e3f2fd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        /* Footer */
        footer {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 50px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            nav a {
                display: block;
                margin: 10px 0;
            }
            
            .settings-corner {
                position: static;
                transform: none;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>

<header>
    <h1><i class="fas fa-graduation-cap"></i> Habineza Tech Academy - CSA & Trade</h1>
    <div class="settings-corner" onclick="showSection('settings')">
        <i class="fas fa-cog"></i>
    </div>
</header>

<nav>
    <a onclick="showSection('home')"><i class="fas fa-home"></i> Home</a>
    <a onclick="showSection('notes')"><i class="fas fa-book"></i> Notes</a>
    <a onclick="showSection('exam')"><i class="fas fa-pencil-alt"></i> Exams</a>
    <a onclick="showSection('login')"><i class="fas fa-sign-in-alt"></i> Login/Register</a>
    <a onclick="showSection('profileSection')"><i class="fas fa-user"></i> Profile</a>
    <a id="adminNavLink" onclick="showSection('adminSection')" style="display:none;"><i class="fas fa-crown"></i> Admin</a>
</nav>

<!-- HOME SECTION -->
<div class="container" id="home" style="display: block;">
    <h2 class="section-title">Welcome to Habineza Tech Academy</h2>
    <div class="card" style="text-align: center;">
        <img id="profilePic" class="profile-pic" src="https://via.placeholder.com/150" onclick="document.getElementById('fileInput').click()">
        <input type="file" id="fileInput" style="display:none" onchange="uploadProfilePic(event)" accept="image/*">
        <h2>Computer Science & Agriculture Trade</h2>
        <p style="color: #666; margin: 20px 0;">Your gateway to professional programming and agricultural technology</p>
        <div id="homeProgress"></div>
        <div style="margin-top: 20px;">
            <button class="btn" onclick="showSection('notes')"><i class="fas fa-book"></i> Start Learning</button>
            <button class="btn btn-success" onclick="showSection('exam')"><i class="fas fa-pencil-alt"></i> Take Exam</button>
        </div>
    </div>
</div>

<!-- NOTES SECTION -->
<div class="container" id="notes">
    <h2 class="section-title">Course Notes</h2>
    <div id="notesContainer"></div>
</div>

<!-- EXAMS SECTION -->
<div class="container" id="exam">
    <h2 class="section-title">Examinations</h2>
    <div id="examContainer"></div>
</div>

<!-- LOGIN/REGISTER SECTION -->
<div class="container" id="login">
    <h2 class="section-title">Login / Register</h2>
    <div class="card" style="max-width: 500px; margin: auto;">
        
        <!-- LOGIN FORM -->
        <div id="loginForm">
            <h3><i class="fas fa-sign-in-alt"></i> Login</h3>
            <input type="email" id="loginEmail" placeholder="Email Address">
            <div class="password-field">
                <input type="password" id="loginPassword" placeholder="Password">
                <i class="fas fa-eye toggle-password" onclick="togglePassword('loginPassword', this)"></i>
            </div>
            <button class="btn" style="width: 100%;" onclick="login()"><i class="fas fa-sign-in-alt"></i> Login</button>
            <p style="text-align: center; margin-top: 15px;">
                <a href="#" onclick="showRegisterForm()">Don't have an account? Register</a>
            </p>
        </div>

        <!-- REGISTER FORM -->
        <div id="registerForm" style="display: none;">
            <h3><i class="fas fa-user-plus"></i> Register</h3>
            <input type="email" id="regEmail" placeholder="Email Address">
            
            <div class="password-field">
                <input type="password" id="regPassword" placeholder="Password (min 8 characters)">
                <i class="fas fa-eye toggle-password" onclick="togglePassword('regPassword', this)"></i>
            </div>
            
            <div class="password-field">
                <input type="password" id="regConfirmPassword" placeholder="Confirm Password">
                <i class="fas fa-eye toggle-password" onclick="togglePassword('regConfirmPassword', this)"></i>
            </div>

            <select id="regMonth">
                <option value="">Month</option>
                <option value="01">January</option>
                <option value="02">February</option>
                <option value="03">March</option>
                <option value="04">April</option>
                <option value="05">May</option>
                <option value="06">June</option>
                <option value="07">July</option>
                <option value="08">August</option>
                <option value="09">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>

            <select id="regDay">
                <option value="">Day</option>
            </select>

            <select id="regYear">
                <option value="">Year</option>
            </select>

            <select id="regCourse">
                <option value="">Select Program</option>
                <option value="CSA">Computer Science & Agriculture</option>
                <option value="Trade">International Trade</option>
                <option value="Both">Both Programs</option>
            </select>

            <button class="btn" style="width: 100%;" onclick="sendVerificationCode()">
                <i class="fas fa-envelope"></i> Send Verification Code
            </button>

            <p style="text-align: center; margin-top: 15px;">
                <a href="#" onclick="showLoginForm()">Already have an account? Login</a>
            </p>
        </div>

        <!-- VERIFICATION FORM -->
        <div id="verificationForm" style="display: none;">
            <h3><i class="fas fa-shield-alt"></i> Email Verification</h3>
            <p>We've sent a 6-digit code to <span id="verificationEmail"></span></p>
            <input type="text" id="verificationCode" placeholder="Enter 6-digit code" maxlength="6">
            <div id="verificationTimer" style="text-align: center; color: #e74c3c; margin: 10px;">Time left: 5:00</div>
            <button class="btn" style="width: 100%;" onclick="verifyAndRegister()">
                <i class="fas fa-check-circle"></i> Verify & Complete Registration
            </button>
            <button class="btn btn-danger" style="width: 100%; margin-top: 10px;" onclick="resendCode()">
                <i class="fas fa-redo"></i> Resend Code
            </button>
        </div>
    </div>
</div>

<!-- PROFILE SECTION -->
<div class="container" id="profileSection">
    <h2 class="section-title">Your Profile</h2>
    <div class="card" style="max-width: 600px; margin: auto;">
        <img id="profilePicProfile" class="profile-pic" src="https://via.placeholder.com/150" onclick="document.getElementById('profileFileInput').click()">
        <input type="file" id="profileFileInput" style="display: none;" onchange="uploadProfilePic(event)" accept="image/*">
        
        <h3 id="userEmail" style="text-align: center;"></h3>
        <p id="userCourse" style="text-align: center; color: #666;"></p>
        <p id="userDOB" style="text-align: center; color: #666;"></p>
        <div id="userRole" style="text-align: center;"></div>

        <h4 style="margin-top: 20px;"><i class="fas fa-check-circle" style="color: #27ae60;"></i> Completed Notes</h4>
        <div id="completedNotes" style="margin-top: 10px;"></div>

        <h4 style="margin-top: 20px;"><i class="fas fa-history"></i> Exam History</h4>
        <div id="examHistory" style="margin-top: 10px;"></div>

        <button class="btn btn-danger" style="width: 100%; margin-top: 20px;" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>
</div>

<!-- SETTINGS SECTION -->
<div class="container" id="settings">
    <h2 class="section-title">Settings</h2>
    <div class="card" style="max-width: 500px; margin: auto;">
        <h3><i class="fas fa-user-circle"></i> Profile Picture</h3>
        <img id="profilePicSettings" class="profile-pic" src="https://via.placeholder.com/150" onclick="document.getElementById('settingsFileInput').click()">
        <input type="file" id="settingsFileInput" style="display: none;" onchange="uploadProfilePic(event)" accept="image/*">

        <h3 style="margin-top: 30px;"><i class="fas fa-lock"></i> Change Password</h3>
        <div class="password-field">
            <input type="password" id="currentPassword" placeholder="Current Password">
            <i class="fas fa-eye toggle-password" onclick="togglePassword('currentPassword', this)"></i>
        </div>
        <div class="password-field">
            <input type="password" id="newPassword" placeholder="New Password">
            <i class="fas fa-eye toggle-password" onclick="togglePassword('newPassword', this)"></i>
        </div>
        <div class="password-field">
            <input type="password" id="confirmNewPassword" placeholder="Confirm New Password">
            <i class="fas fa-eye toggle-password" onclick="togglePassword('confirmNewPassword', this)"></i>
        </div>
        <button class="btn" style="width: 100%;" onclick="changePassword()">
            <i class="fas fa-key"></i> Update Password
        </button>

        <h3 style="margin-top: 30px;"><i class="fas fa-database"></i> Data Management</h3>
        <button class="btn btn-danger" style="width: 100%;" onclick="clearAllData()">
            <i class="fas fa-trash"></i> Clear My Progress
        </button>
        <button class="btn btn-success" style="width: 100%; margin-top: 10px;" onclick="exportData()">
            <i class="fas fa-download"></i> Export My Data
        </button>
    </div>
</div>

<!-- ADMIN SECTION -->
<div class="container" id="adminSection">
    <h2 class="section-title">Admin Dashboard</h2>
    <div class="card">
        <h3><i class="fas fa-users"></i> All Users</h3>
        <div id="usersList"></div>
    </div>
    <div class="card">
        <h3><i class="fas fa-chart-bar"></i> Platform Statistics</h3>
        <div id="adminStats"></div>
    </div>
</div>

<footer>
    <i class="fas fa-copyright"></i> 2026 Habineza Tech Academy - CSA & Trade | All Rights Reserved
</footer>

<script>
    // ==================== INITIALIZATION ====================
    window.onload = function() {
        // Populate date dropdowns
        populateDateDropdowns();
        
        // Load notes and exams
        loadNotes();
        loadExams();
        
        // Initialize default admin
        initDefaultAdmin();
        
        // Check if user is logged in
        let user = getCurrentUser();
        if (user) {
            loadProfile();
            checkAdminAccess();
        }
    };

    // ==================== DATA STORAGE ====================
    function getUsers() {
        return JSON.parse(localStorage.getItem('users')) || [];
    }

    function saveUsers(users) {
        localStorage.setItem('users', JSON.stringify(users));
    }

    function getCurrentUser() {
        return JSON.parse(localStorage.getItem('currentUser'));
    }

    // Simple hash (for demo only)
    function hashPassword(password) {
        return btoa(password);
    }

    // ==================== INITIALIZE DEFAULT ADMIN ====================
    function initDefaultAdmin() {
        let users = getUsers();
        if (!users.some(u => u.email === "admin@habineza.com")) {
            users.push({
                email: "admin@habineza.com",
                password: hashPassword("Admin123"),
                role: "admin",
                course: "Both",
                dob: "1990-01-01",
                verified: true,
                completedNotes: [],
                examHistory: [],
                profilePic: null,
                createdAt: new Date().toISOString()
            });
            saveUsers(users);
        }
    }

    // ==================== POPULATE DATE DROPDOWNS ====================
    function populateDateDropdowns() {
        // Days
        let daySelect = document.getElementById('regDay');
        for (let i = 1; i <= 31; i++) {
            let option = document.createElement('option');
            option.value = i.toString().padStart(2, '0');
            option.text = i;
            daySelect.appendChild(option);
        }

        // Years (1950-2010)
        let yearSelect = document.getElementById('regYear');
        let currentYear = new Date().getFullYear();
        for (let i = currentYear - 16; i >= 1950; i--) {
            let option = document.createElement('option');
            option.value = i;
            option.text = i;
            yearSelect.appendChild(option);
        }
    }

    // ==================== TOGGLE PASSWORD VISIBILITY ====================
    function togglePassword(inputId, icon) {
        let input = document.getElementById(inputId);
        if (input.type === "password") {
            input.type = "text";
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = "password";
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    // ==================== SHOW/HIDE FORMS ====================
    function showRegisterForm() {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registerForm').style.display = 'block';
        document.getElementById('verificationForm').style.display = 'none';
    }

    function showLoginForm() {
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('verificationForm').style.display = 'none';
    }

    // ==================== REGISTRATION VARIABLES ====================
    let pendingRegistration = null;
    let verificationCode = null;
    let verificationTimer = null;
    let timeLeft = 300;

    // ==================== SEND VERIFICATION CODE ====================
    function sendVerificationCode() {
        const email = document.getElementById('regEmail').value.trim();
        const password = document.getElementById('regPassword').value;
        const confirmPass = document.getElementById('regConfirmPassword').value;
        const month = document.getElementById('regMonth').value;
        const day = document.getElementById('regDay').value;
        const year = document.getElementById('regYear').value;
        const course = document.getElementById('regCourse').value;

        if (!email || !password || !confirmPass || !month || !day || !year || !course) {
            alert("Please fill in all fields!");
            return;
        }

        if (password.length < 8) {
            alert("Password must be at least 8 characters!");
            return;
        }

        if (password !== confirmPass) {
            alert("Passwords do not match!");
            return;
        }

        if (!email.includes('@') || !email.includes('.')) {
            alert("Please enter a valid email!");
            return;
        }

        let users = getUsers();
        if (users.some(u => u.email === email)) {
            alert("Email already registered!");
            return;
        }

        verificationCode = Math.floor(100000 + Math.random() * 900000).toString();

        pendingRegistration = {
            email: email,
            password: hashPassword(password),
            course: course,
            dob: `${year}-${month}-${day}`,
            role: 'user',
            verified: false,
            completedNotes: [],
            examHistory: [],
            profilePic: null,
            createdAt: new Date().toISOString()
        };

        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('verificationForm').style.display = 'block';
        document.getElementById('verificationEmail').textContent = email;

        startVerificationTimer();
        alert(`[DEMO] Your verification code is: ${verificationCode}`);
    }

    function startVerificationTimer() {
        timeLeft = 300;
        updateTimerDisplay();

        if (verificationTimer) clearInterval(verificationTimer);

        verificationTimer = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();

            if (timeLeft <= 0) {
                clearInterval(verificationTimer);
                document.getElementById('verificationTimer').innerHTML = "Code expired! Please request new one.";
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        let minutes = Math.floor(timeLeft / 60);
        let seconds = timeLeft % 60;
        document.getElementById('verificationTimer').innerHTML = 
            `Time left: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function verifyAndRegister() {
        const code = document.getElementById('verificationCode').value.trim();

        if (!code) {
            alert("Please enter verification code!");
            return;
        }

        if (code !== verificationCode) {
            alert("Invalid verification code!");
            return;
        }

        if (timeLeft <= 0) {
            alert("Code expired! Please request new one.");
            return;
        }

        pendingRegistration.verified = true;
        let users = getUsers();
        users.push(pendingRegistration);
        saveUsers(users);

        clearInterval(verificationTimer);
        alert("Registration successful! You can now login.");

        showLoginForm();
        
        document.getElementById('regEmail').value = '';
        document.getElementById('regPassword').value = '';
        document.getElementById('regConfirmPassword').value = '';
    }

    function resendCode() {
        if (pendingRegistration) {
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            alert(`[DEMO] New verification code: ${verificationCode}`);
            startVerificationTimer();
        }
    }

    // ==================== LOGIN ====================
    function login() {
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;

        if (!email || !password) {
            alert("Please enter email and password!");
            return;
        }

        let users = getUsers();
        const hashedPassword = hashPassword(password);
        const user = users.find(u => u.email === email && u.password === hashedPassword);

        if (user) {
            if (!user.verified) {
                alert("Please verify your email first!");
                return;
            }

            localStorage.setItem('currentUser', JSON.stringify(user));
            alert("Login successful!");
            
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            
            showSection('home');
            loadProfile();
            checkAdminAccess();
            updateHomeProgress();
        } else {
            alert("Incorrect email or password!");
        }
    }

    // ==================== LOGOUT ====================
    function logout() {
        localStorage.removeItem('currentUser');
        alert("Logged out!");
        showSection('login');
        document.getElementById('adminNavLink').style.display = 'none';
    }

    // ==================== CHECK ADMIN ====================
    function isAdmin() {
        let user = getCurrentUser();
        return user && user.role === 'admin';
    }

    function checkAdminAccess() {
        if (isAdmin()) {
            document.getElementById('adminNavLink').style.display = 'inline';
        } else {
            document.getElementById('adminNavLink').style.display = 'none';
        }
    }

    // ==================== SHOW SECTION ====================
    function showSection(id) {
        // Hide all containers
        document.querySelectorAll('.container').forEach(div => {
            div.style.display = 'none';
        });
        
        // Show selected container
        document.getElementById(id).style.display = 'block';
        
        // Load data based on section
        if (id === 'notes') {
            loadNotes();
        }
        if (id === 'exam') {
            loadExams();
        }
        if (id === 'profileSection') {
            loadProfile();
        }
        if (id === 'adminSection' && isAdmin()) {
            loadAdminDashboard();
        }
        if (id === 'home') {
            updateHomeProgress();
        }
    }

    // ==================== NOTES DATA ====================
    const notesData = [
        {
            id: 'csa1',
            title: "Introduction to Computer Science in Agriculture",
            course: "CSA",
            content: `COMPUTER SCIENCE IN AGRICULTURE (CSA)

1. Digital Farming Technologies
   • Precision Agriculture
   • Smart Sensors
   • IoT in Agriculture
   • Automated Systems

2. Data Analytics in Farming
   • Crop Yield Prediction
   • Soil Analysis
   • Weather Forecasting
   • Market Analysis

3. Programming Applications
   • Python for Agriculture
   • Arduino for Automation
   • Mobile Apps for Farmers
   • Database Management`
        },
        {
            id: 'csa2',
            title: "Smart Farming Systems",
            course: "CSA",
            content: `SMART FARMING TECHNOLOGIES

1. IoT Sensors
   • Soil Moisture Sensors
   • Temperature Sensors
   • Humidity Sensors
   • Light Sensors

2. Automation Systems
   • Automated Irrigation
   • Drone Monitoring
   • Robotic Harvesting
   • Smart Greenhouses

3. Data Management
   • Cloud Storage
   • Real-time Monitoring
   • Mobile Applications
   • Decision Support Systems`
        },
        {
            id: 'trade1',
            title: "International Trade Fundamentals",
            course: "Trade",
            content: `INTERNATIONAL TRADE BASICS

1. Trade Theories
   • Comparative Advantage
   • Absolute Advantage
   • Heckscher-Ohlin Model
   • New Trade Theory

2. Trade Agreements
   • WTO Framework
   • Regional Agreements
   • Bilateral Treaties
   • Trade Blocs

3. Trade Documentation
   • Bill of Lading
   • Letter of Credit
   • Commercial Invoice
   • Certificate of Origin`
        },
        {
            id: 'trade2',
            title: "Export-Import Procedures",
            course: "Trade",
            content: `EXPORT-IMPORT PROCEDURES

1. Export Process
   • Market Research
   • Product Compliance
   • Documentation
   • Shipping
   • Payment Collection

2. Import Process
   • Supplier Identification
   • Negotiation
   • Customs Clearance
   • Quality Inspection
   • Distribution

3. Incoterms 2020
   • EXW (Ex Works)
   • FOB (Free on Board)
   • CIF (Cost, Insurance, Freight)
   • DDP (Delivered Duty Paid)`
        }
    ];

    // ==================== EXAMS DATA ====================
    const examsData = [
        {
            id: 'exam_csa1',
            title: "CSA Fundamentals Exam",
            course: "CSA",
            time: 600,
            questions: [
                {
                    q: "What is Precision Agriculture?",
                    options: [
                        "Farming using GPS and data analytics",
                        "Traditional farming methods",
                        "Organic farming only",
                        "Manual farming techniques"
                    ],
                    answer: 0
                },
                {
                    q: "Which sensor measures soil moisture?",
                    options: [
                        "Humidity sensor",
                        "Temperature sensor",
                        "Pressure sensor",
                        "Light sensor"
                    ],
                    answer: 0
                },
                {
                    q: "What does IoT stand for?",
                    options: [
                        "Internet of Things",
                        "Internet of Tractors",
                        "Integration of Technology",
                        "Intelligent Operations Technology"
                    ],
                    answer: 0
                }
            ]
        },
        {
            id: 'exam_trade1',
            title: "International Trade Basics",
            course: "Trade",
            time: 600,
            questions: [
                {
                    q: "What does FOB stand for?",
                    options: [
                        "Free on Board",
                        "Freight on Board",
                        "Forward on Board",
                        "Final Order Board"
                    ],
                    answer: 0
                },
                {
                    q: "Which document is a contract with shipping line?",
                    options: [
                        "Bill of Lading",
                        "Commercial Invoice",
                        "Packing List",
                        "Certificate of Origin"
                    ],
                    answer: 0
                },
                {
                    q: "What is a Letter of Credit?",
                    options: [
                        "Bank guarantee of payment",
                        "Shipping document",
                        "Insurance policy",
                        "Quality certificate"
                    ],
                    answer: 0
                }
            ]
        }
    ];

    // ==================== LOAD NOTES ====================
    function loadNotes() {
        const container = document.getElementById('notesContainer');
        container.innerHTML = '';

        notesData.forEach(note => {
            const noteCard = document.createElement('div');
            noteCard.className = 'card';
            noteCard.innerHTML = `
                <h3><i class="fas fa-book-open"></i> ${note.title}</h3>
                <p style="color: #666; margin: 10px 0;">Course: ${note.course}</p>
                <pre style="background: #f5f5f5; padding: 15px; border-radius: 10px; white-space: pre-wrap; font-family: monospace;">${note.content}</pre>
                <button class="btn" onclick="completeNote('${note.title}')">
                    <i class="fas fa-check-circle"></i> Mark as Completed
                </button>
            `;
            container.appendChild(noteCard);
        });
    }

    // ==================== COMPLETE NOTE ====================
    function completeNote(title) {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            showSection('login');
            return;
        }

        if (!user.completedNotes) {
            user.completedNotes = [];
        }

        if (!user.completedNotes.includes(title)) {
            user.completedNotes.push(title);
            
            let users = getUsers();
            let index = users.findIndex(u => u.email === user.email);
            if (index !== -1) {
                users[index] = user;
                saveUsers(users);
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
            
            alert("Note marked as completed!");
            loadProfile();
        } else {
            alert("You already completed this note!");
        }
    }

    // ==================== LOAD EXAMS ====================
    function loadExams() {
        const container = document.getElementById('examContainer');
        container.innerHTML = '';

        examsData.forEach((exam, index) => {
            const examCard = document.createElement('div');
            examCard.className = 'card';
            examCard.innerHTML = `
                <h3><i class="fas fa-pencil-alt"></i> ${exam.title}</h3>
                <p style="color: #666; margin: 10px 0;">Course: ${exam.course}</p>
                <p>Questions: ${exam.questions.length} | Time: ${exam.time/60} minutes</p>
                <button class="btn btn-success" onclick="startExam(${index})">
                    <i class="fas fa-play"></i> Start Exam
                </button>
            `;
            container.appendChild(examCard);
        });
    }

    // ==================== START EXAM ====================
    let currentExamIndex = 0;
    let examTimer = null;
    let examTimeLeft = 0;
    let userAnswers = [];

    function startExam(index) {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            showSection('login');
            return;
        }

        currentExamIndex = index;
        const exam = examsData[index];
        
        // Reset answers
        userAnswers = new Array(exam.questions.length).fill(null);
        
        // Build exam HTML
        let examHTML = `
            <div class="card">
                <h3>${exam.title}</h3>
                <div class="exam-timer" id="examTimer">Time left: ${Math.floor(exam.time/60)}:00</div>
                <form id="examForm">
        `;
        
        exam.questions.forEach((q, qIndex) => {
            examHTML += `
                <div style="margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 10px;">
                    <p><strong>${qIndex + 1}. ${q.q}</strong></p>
            `;
            
            q.options.forEach((opt, optIndex) => {
                examHTML += `
                    <label style="display: block; margin: 10px 0;">
                        <input type="radio" name="q${qIndex}" value="${optIndex}" onchange="saveAnswer(${qIndex}, ${optIndex})">
                        ${opt}
                    </label>
                `;
            });
            
            examHTML += `</div>`;
        });
        
        examHTML += `
                </form>
                <button class="btn btn-success" onclick="submitExam()">Submit Exam</button>
                <button class="btn btn-danger" onclick="loadExams()">Cancel</button>
            </div>
        `;
        
        document.getElementById('examContainer').innerHTML = examHTML;
        
        // Start timer
        examTimeLeft = exam.time;
        updateExamTimer();
        
        if (examTimer) clearInterval(examTimer);
        examTimer = setInterval(updateExamTimer, 1000);
    }

    function updateExamTimer() {
        examTimeLeft--;
        
        let minutes = Math.floor(examTimeLeft / 60);
        let seconds = examTimeLeft % 60;
        
        document.getElementById('examTimer').innerHTML = 
            `Time left: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (examTimeLeft <= 0) {
            clearInterval(examTimer);
            submitExam();
        }
    }

    function saveAnswer(questionIndex, answerIndex) {
        userAnswers[questionIndex] = answerIndex;
    }

    function submitExam() {
        clearInterval(examTimer);
        
        const exam = examsData[currentExamIndex];
        let score = 0;
        
        exam.questions.forEach((q, index) => {
            if (userAnswers[index] === q.answer) {
                score++;
            }
        });
        
        const percentage = Math.round((score / exam.questions.length) * 100);
        const passed = percentage >= 60;
        
        // Save to user history
        let user = getCurrentUser();
        if (user) {
            if (!user.examHistory) {
                user.examHistory = [];
            }
            
            user.examHistory.push({
                exam: exam.title,
                score: percentage,
                passed: passed,
                date: new Date().toLocaleDateString()
            });
            
            let users = getUsers();
            let index = users.findIndex(u => u.email === user.email);
            if (index !== -1) {
                users[index] = user;
                saveUsers(users);
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
        }
        
        // Show result
        alert(`Exam Complete!\nScore: ${percentage}%\n${passed ? 'PASSED!' : 'FAILED'}`);
        
        loadExams();
    }

    // ==================== LOAD PROFILE ====================
    function loadProfile() {
        let user = getCurrentUser();
        if (!user) return;
        
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userCourse').textContent = `Program: ${user.course}`;
        document.getElementById('userDOB').textContent = `Date of Birth: ${user.dob}`;
        
        if (user.role === 'admin') {
            document.getElementById('userRole').innerHTML = '<span class="admin-badge">Admin</span>';
        } else {
            document.getElementById('userRole').innerHTML = '';
        }
        
        // Completed notes
        let completedHTML = '';
        if (user.completedNotes && user.completedNotes.length > 0) {
            user.completedNotes.forEach(note => {
                completedHTML += `<div class="completed-note"><i class="fas fa-check-circle" style="color: #27ae60;"></i> ${note}</div>`;
            });
        } else {
            completedHTML = '<p>No completed notes yet.</p>';
        }
        document.getElementById('completedNotes').innerHTML = completedHTML;
        
        // Exam history
        let historyHTML = '';
        if (user.examHistory && user.examHistory.length > 0) {
            user.examHistory.forEach(exam => {
                historyHTML += `
                    <div class="exam-history-item">
                        <strong>${exam.exam}</strong><br>
                        Score: ${exam.score}% - ${exam.passed ? 'PASSED' : 'FAILED'}<br>
                        Date: ${exam.date}
                    </div>
                `;
            });
        } else {
            historyHTML = '<p>No exams taken yet.</p>';
        }
        document.getElementById('examHistory').innerHTML = historyHTML;
        
        // Profile picture
        if (user.profilePic) {
            document.getElementById('profilePic').src = user.profilePic;
            document.getElementById('profilePicProfile').src = user.profilePic;
            document.getElementById('profilePicSettings').src = user.profilePic;
        }
    }

    // ==================== UPDATE HOME PROGRESS ====================
    function updateHomeProgress() {
        let user = getCurrentUser();
        if (!user) {
            document.getElementById('homeProgress').innerHTML = '<p>Please login to see your progress.</p>';
            return;
        }
        
        let notesCompleted = user.completedNotes ? user.completedNotes.length : 0;
        let examsTaken = user.examHistory ? user.examHistory.length : 0;
        
        document.getElementById('homeProgress').innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div style="background: #e8f5e9; padding: 15px; border-radius: 10px;">
                    <h3 style="color: #27ae60;">${notesCompleted}</h3>
                    <p>Notes Completed</p>
                </div>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px;">
                    <h3 style="color: #3498db;">${examsTaken}</h3>
                    <p>Exams Taken</p>
                </div>
            </div>
        `;
    }

    // ==================== UPLOAD PROFILE PIC ====================
    function uploadProfilePic(event) {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            return;
        }
        
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            user.profilePic = e.target.result;
            
            let users = getUsers();
            let index = users.findIndex(u => u.email === user.email);
            if (index !== -1) {
                users[index] = user;
                saveUsers(users);
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
            
            document.getElementById('profilePic').src = e.target.result;
            document.getElementById('profilePicProfile').src = e.target.result;
            document.getElementById('profilePicSettings').src = e.target.result;
            
            alert("Profile picture updated!");
        };
        reader.readAsDataURL(file);
    }

    // ==================== CHANGE PASSWORD ====================
    function changePassword() {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            return;
        }
        
        const current = document.getElementById('currentPassword').value;
        const newPass = document.getElementById('newPassword').value;
        const confirm = document.getElementById('confirmNewPassword').value;
        
        if (!current || !newPass || !confirm) {
            alert("Please fill in all fields!");
            return;
        }
        
        if (hashPassword(current) !== user.password) {
            alert("Current password is incorrect!");
            return;
        }
        
        if (newPass.length < 8) {
            alert("New password must be at least 8 characters!");
            return;
        }
        
        if (newPass !== confirm) {
            alert("New passwords do not match!");
            return;
        }
        
        user.password = hashPassword(newPass);
        
        let users = getUsers();
        let index = users.findIndex(u => u.email === user.email);
        if (index !== -1) {
            users[index] = user;
            saveUsers(users);
            localStorage.setItem('currentUser', JSON.stringify(user));
        }
        
        alert("Password updated successfully!");
        
        document.getElementById('currentPassword').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmNewPassword').value = '';
    }

    // ==================== CLEAR ALL DATA ====================
    function clearAllData() {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            return;
        }
        
        if (confirm("Are you sure you want to clear all your progress? This cannot be undone!")) {
            user.completedNotes = [];
            user.examHistory = [];
            
            let users = getUsers();
            let index = users.findIndex(u => u.email === user.email);
            if (index !== -1) {
                users[index] = user;
                saveUsers(users);
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
            
            alert("Progress cleared!");
            loadProfile();
        }
    }

    // ==================== EXPORT DATA ====================
    function exportData() {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            return;
        }
        
        const data = {
            email: user.email,
            course: user.course,
            dob: user.dob,
            role: user.role,
            completedNotes: user.completedNotes || [],
            examHistory: user.examHistory || [],
            exportDate: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `habineza-${user.email}-data.json`;
        a.click();
        
        alert("Data exported successfully!");
    }

    // ==================== LOAD ADMIN DASHBOARD ====================
    function loadAdminDashboard() {
        if (!isAdmin()) return;
        
        const users = getUsers();
        let usersHTML = '';
        
        users.forEach(user => {
            usersHTML += `
                <div class="user-row">
                    <div>
                        <strong>${user.email}</strong>
                        ${user.role === 'admin' ? '<span class="admin-badge">Admin</span>' : ''}
                        <div style="font-size: 12px; color: #666;">
                            Course: ${user.course} | Notes: ${user.completedNotes ? user.completedNotes.length : 0} | Exams: ${user.examHistory ? user.examHistory.length : 0}
                        </div>
                    </div>
                    ${user.role !== 'admin' ? `
                        <div>
                            <button class="btn" style="padding: 5px 10px; font-size: 12px;" onclick="makeAdmin('${user.email}')">Make Admin</button>
                            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteUser('${user.email}')">Delete</button>
                        </div>
                    ` : ''}
                </div>
            `;
        });
        
        document.getElementById('usersList').innerHTML = usersHTML || '<p>No users found.</p>';
        
        // Statistics
        const totalUsers = users.length;
        const totalAdmins = users.filter(u => u.role === 'admin').length;
        const totalNotes = users.reduce((sum, u) => sum + (u.completedNotes ? u.completedNotes.length : 0), 0);
        const totalExams = users.reduce((sum, u) => sum + (u.examHistory ? u.examHistory.length : 0), 0);
        
        document.getElementById('adminStats').innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="color: #3498db;">${totalUsers}</h3>
                    <p>Total Users</p>
                </div>
                <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="color: #e74c3c;">${totalAdmins}</h3>
                    <p>Admins</p>
                </div>
                <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="color: #27ae60;">${totalNotes}</h3>
                    <p>Notes Completed</p>
                </div>
                <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="color: #f39c12;">${totalExams}</h3>
                    <p>Exams Taken</p>
                </div>
            </div>
        `;
    }

    // ==================== MAKE ADMIN ====================
    function makeAdmin(email) {
        if (!isAdmin()) return;
        
        if (confirm(`Make ${email} an admin?`)) {
            let users = getUsers();
            let user = users.find(u => u.email === email);
            if (user) {
                user.role = 'admin';
                saveUsers(users);
                loadAdminDashboard();
                alert(`${email} is now an admin!`);
            }
        }
    }

    // ==================== DELETE USER ====================
    function deleteUser(email) {
        if (!isAdmin()) return;
        
        if (confirm(`Delete user ${email}? This cannot be undone!`)) {
            let users = getUsers();
            users = users.filter(u => u.email !== email);
            saveUsers(users);
            
            // If current user is deleted, logout
            let current = getCurrentUser();
            if (current && current.email === email) {
                logout();
            }
            
            loadAdminDashboard();
            alert("User deleted!");
        }
    }
</script>

</body>
</html>
