<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habineza Tech Academy - Computer System & Architecture</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            min-height: 100vh;
        }

        /* Header */
        header {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 20px rgba(0,0,0,0.2);
        }

        .settings-corner {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            cursor: pointer;
            color: white;
            transition: all 0.3s;
        }

        .settings-corner:hover {
            transform: translateY(-50%) rotate(90deg);
            color: #3498db;
        }

        /* Navigation */
        nav {
            background: rgba(31, 45, 61, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 20px;
            border-radius: 25px;
            transition: all 0.3s;
            display: inline-block;
        }

        nav a:hover {
            background: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52,152,219,0.4);
        }

        nav a i {
            margin-right: 5px;
        }

        /* Container */
        .container {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            display: none;
        }

        .section-title {
            font-size: 32px;
            color: white;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* Cards */
        .card {
            background: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-left: 5px solid #3498db;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(52,152,219,0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        /* Forms */
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52,152,219,0.3);
        }

        /* Password field with toggle */
        .password-field {
            position: relative;
            width: 100%;
        }

        .password-field input {
            padding-right: 40px;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #666;
        }

        .toggle-password:hover {
            color: #3498db;
        }

        /* Profile picture */
        .profile-pic {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #3498db;
            margin: 10px auto;
            display: block;
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-pic:hover {
            transform: scale(1.05);
            border-color: #2980b9;
        }

        /* Timer */
        .exam-timer {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        /* Admin badge */
        .admin-badge {
            background: #e74c3c;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
        }

        /* User list */
        .user-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .user-row:last-child {
            border-bottom: none;
        }

        /* Completed notes */
        .completed-note {
            background: #e8f5e9;
            padding: 10px;
            margin: 5px 0;
            border-radius: 10px;
            border-left: 4px solid #27ae60;
        }

        /* Exam history */
        .exam-history-item {
            background: #e3f2fd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        /* Code blocks */
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
        }

        code {
            font-family: 'Courier New', monospace;
        }

        /* Footer */
        footer {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 50px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            nav a {
                display: block;
                margin: 10px 0;
            }
            
            .settings-corner {
                position: static;
                transform: none;
                margin-top: 10px;
            }
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #27ae60, #3498db);
            transition: width 0.3s;
        }

        /* Topic tags */
        .topic-tag {
            display: inline-block;
            padding: 3px 10px;
            background: #3498db;
            color: white;
            border-radius: 15px;
            font-size: 12px;
            margin: 2px;
        }

        /* Search bar */
        .search-bar {
            margin: 20px 0;
            position: relative;
        }

        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .search-bar input {
            padding-left: 40px;
        }
    </style>
</head>
<body>

<header>
    <h1><i class="fas fa-microchip"></i> Habineza Tech Academy - Computer System & Architecture</h1>
    <div class="settings-corner" onclick="showSection('settings')">
        <i class="fas fa-cog"></i>
    </div>
</header>

<nav>
    <a onclick="showSection('home')"><i class="fas fa-home"></i> Home</a>
    <a onclick="showSection('notes')"><i class="fas fa-book"></i> Notes</a>
    <a onclick="showSection('exam')"><i class="fas fa-pencil-alt"></i> Exams</a>
    <a onclick="showSection('login')"><i class="fas fa-sign-in-alt"></i> Login/Register</a>
    <a onclick="showSection('profileSection')"><i class="fas fa-user"></i> Profile</a>
    <a id="adminNavLink" onclick="showSection('adminSection')" style="display:none;"><i class="fas fa-crown"></i> Admin</a>
</nav>

<!-- HOME SECTION -->
<div class="container" id="home" style="display: block;">
    <h2 class="section-title">Welcome to Computer System & Architecture</h2>
    <div class="card" style="text-align: center;">
        <img id="profilePic" class="profile-pic" src="https://via.placeholder.com/150" onclick="document.getElementById('fileInput').click()">
        <input type="file" id="fileInput" style="display:none" onchange="uploadProfilePic(event)" accept="image/*">
        <h2>Computer System & Architecture (CSA)</h2>
        <p style="color: #666; margin: 20px 0;">Master C++, Firmware, Refurbishment, and C Programming</p>
        
        <div style="margin: 20px 0;">
            <span class="topic-tag">C++</span>
            <span class="topic-tag">Firmware</span>
            <span class="topic-tag">Refurbishment</span>
            <span class="topic-tag">C Programming</span>
            <span class="topic-tag">Computer Architecture</span>
        </div>
        
        <div id="homeProgress"></div>
        
        <div style="margin-top: 20px;">
            <button class="btn" onclick="showSection('notes')"><i class="fas fa-book"></i> Start Learning</button>
            <button class="btn btn-success" onclick="showSection('exam')"><i class="fas fa-pencil-alt"></i> Take Exam</button>
        </div>
    </div>

    <div class="card">
        <h3><i class="fas fa-chart-line"></i> Your Learning Path</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="overallProgress" style="width: 0%"></div>
        </div>
        <p id="progressText">0% Complete</p>
    </div>
</div>

<!-- NOTES SECTION -->
<div class="container" id="notes">
    <h2 class="section-title">Computer System & Architecture Notes</h2>
    
    <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="noteSearch" placeholder="Search notes..." onkeyup="searchNotes()">
    </div>
    
    <div style="text-align: center; margin-bottom: 20px;">
        <button class="btn" onclick="filterNotes('all')">All</button>
        <button class="btn" onclick="filterNotes('C++')">C++</button>
        <button class="btn" onclick="filterNotes('Firmware')">Firmware</button>
        <button class="btn" onclick="filterNotes('Refurbishment')">Refurbishment</button>
        <button class="btn" onclick="filterNotes('C')">C Programming</button>
        <button class="btn" onclick="filterNotes('Architecture')">Architecture</button>
    </div>
    
    <div id="notesContainer"></div>
</div>

<!-- EXAMS SECTION -->
<div class="container" id="exam">
    <h2 class="section-title">CSA Examinations</h2>
    
    <div style="text-align: center; margin-bottom: 20px;">
        <button class="btn" onclick="filterExams('all')">All Exams</button>
        <button class="btn" onclick="filterExams('C++')">C++ Exams</button>
        <button class="btn" onclick="filterExams('Firmware')">Firmware Exams</button>
        <button class="btn" onclick="filterExams('Refurbishment')">Refurbishment</button>
        <button class="btn" onclick="filterExams('C')">C Programming</button>
    </div>
    
    <div id="examContainer"></div>
</div>

<!-- LOGIN/REGISTER SECTION -->
<div class="container" id="login">
    <h2 class="section-title">Login / Register</h2>
    <div class="card" style="max-width: 500px; margin: auto;">
        
        <!-- LOGIN FORM -->
        <div id="loginForm">
            <h3><i class="fas fa-sign-in-alt"></i> Login</h3>
            <input type="email" id="loginEmail" placeholder="Email Address">
            <div class="password-field">
                <input type="password" id="loginPassword" placeholder="Password">
                <i class="fas fa-eye toggle-password" onclick="togglePassword('loginPassword', this)"></i>
            </div>
            <button class="btn" style="width: 100%;" onclick="login()"><i class="fas fa-sign-in-alt"></i> Login</button>
            <p style="text-align: center; margin-top: 15px;">
                <a href="#" onclick="showRegisterForm()">Don't have an account? Register</a>
            </p>
        </div>

        <!-- REGISTER FORM -->
        <div id="registerForm" style="display: none;">
            <h3><i class="fas fa-user-plus"></i> Register</h3>
            <input type="email" id="regEmail" placeholder="Email Address">
            
            <div class="password-field">
                <input type="password" id="regPassword" placeholder="Password (min 8 characters)">
                <i class="fas fa-eye toggle-password" onclick="togglePassword('regPassword', this)"></i>
            </div>
            
            <div class="password-field">
                <input type="password" id="regConfirmPassword" placeholder="Confirm Password">
                <i class="fas fa-eye toggle-password" onclick="togglePassword('regConfirmPassword', this)"></i>
            </div>

            <select id="regMonth">
                <option value="">Month</option>
                <option value="01">January</option>
                <option value="02">February</option>
                <option value="03">March</option>
                <option value="04">April</option>
                <option value="05">May</option>
                <option value="06">June</option>
                <option value="07">July</option>
                <option value="08">August</option>
                <option value="09">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>

            <select id="regDay">
                <option value="">Day</option>
            </select>

            <select id="regYear">
                <option value="">Year</option>
            </select>

            <select id="regCourse">
                <option value="">Select Specialization</option>
                <option value="C++">C++ Programming</option>
                <option value="Firmware">Firmware Engineering</option>
                <option value="Refurbishment">Computer Refurbishment</option>
                <option value="C">C Programming</option>
                <option value="Architecture">Computer Architecture</option>
                <option value="All">Full CSA Program</option>
            </select>

            <button class="btn" style="width: 100%;" onclick="sendVerificationCode()">
                <i class="fas fa-envelope"></i> Send Verification Code
            </button>

            <p style="text-align: center; margin-top: 15px;">
                <a href="#" onclick="showLoginForm()">Already have an account? Login</a>
            </p>
        </div>

        <!-- VERIFICATION FORM -->
        <div id="verificationForm" style="display: none;">
            <h3><i class="fas fa-shield-alt"></i> Email Verification</h3>
            <p>We've sent a 6-digit code to <span id="verificationEmail"></span></p>
            <input type="text" id="verificationCode" placeholder="Enter 6-digit code" maxlength="6">
            <div id="verificationTimer" style="text-align: center; color: #e74c3c; margin: 10px;">Time left: 5:00</div>
            <button class="btn" style="width: 100%;" onclick="verifyAndRegister()">
                <i class="fas fa-check-circle"></i> Verify & Complete Registration
            </button>
            <button class="btn btn-danger" style="width: 100%; margin-top: 10px;" onclick="resendCode()">
                <i class="fas fa-redo"></i> Resend Code
            </button>
        </div>
    </div>
</div>

<!-- PROFILE SECTION -->
<div class="container" id="profileSection">
    <h2 class="section-title">Your Profile</h2>
    <div class="card" style="max-width: 600px; margin: auto;">
        <img id="profilePicProfile" class="profile-pic" src="https://via.placeholder.com/150" onclick="document.getElementById('profileFileInput').click()">
        <input type="file" id="profileFileInput" style="display: none;" onchange="uploadProfilePic(event)" accept="image/*">
        
        <h3 id="userEmail" style="text-align: center;"></h3>
        <p id="userCourse" style="text-align: center; color: #666;"></p>
        <p id="userDOB" style="text-align: center; color: #666;"></p>
        <div id="userRole" style="text-align: center;"></div>

        <h4 style="margin-top: 20px;"><i class="fas fa-check-circle" style="color: #27ae60;"></i> Completed Notes</h4>
        <div id="completedNotes" style="margin-top: 10px;"></div>

        <h4 style="margin-top: 20px;"><i class="fas fa-history"></i> Exam History</h4>
        <div id="examHistory" style="margin-top: 10px;"></div>

        <h4 style="margin-top: 20px;"><i class="fas fa-chart-line"></i> Overall Progress</h4>
        <div class="progress-bar">
            <div class="progress-fill" id="profileProgress" style="width: 0%"></div>
        </div>
        <p id="profileProgressText">0% Complete</p>

        <button class="btn btn-danger" style="width: 100%; margin-top: 20px;" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>
</div>

<!-- SETTINGS SECTION -->
<div class="container" id="settings">
    <h2 class="section-title">Settings</h2>
    <div class="card" style="max-width: 500px; margin: auto;">
        <h3><i class="fas fa-user-circle"></i> Profile Picture</h3>
        <img id="profilePicSettings" class="profile-pic" src="https://via.placeholder.com/150" onclick="document.getElementById('settingsFileInput').click()">
        <input type="file" id="settingsFileInput" style="display: none;" onchange="uploadProfilePic(event)" accept="image/*">

        <h3 style="margin-top: 30px;"><i class="fas fa-lock"></i> Change Password</h3>
        <div class="password-field">
            <input type="password" id="currentPassword" placeholder="Current Password">
            <i class="fas fa-eye toggle-password" onclick="togglePassword('currentPassword', this)"></i>
        </div>
        <div class="password-field">
            <input type="password" id="newPassword" placeholder="New Password">
            <i class="fas fa-eye toggle-password" onclick="togglePassword('newPassword', this)"></i>
        </div>
        <div class="password-field">
            <input type="password" id="confirmNewPassword" placeholder="Confirm New Password">
            <i class="fas fa-eye toggle-password" onclick="togglePassword('confirmNewPassword', this)"></i>
        </div>
        <button class="btn" style="width: 100%;" onclick="changePassword()">
            <i class="fas fa-key"></i> Update Password
        </button>

        <h3 style="margin-top: 30px;"><i class="fas fa-database"></i> Data Management</h3>
        <button class="btn btn-danger" style="width: 100%;" onclick="clearAllData()">
            <i class="fas fa-trash"></i> Clear My Progress
        </button>
        <button class="btn btn-success" style="width: 100%; margin-top: 10px;" onclick="exportData()">
            <i class="fas fa-download"></i> Export My Data
        </button>
    </div>
</div>

<!-- ADMIN SECTION -->
<div class="container" id="adminSection">
    <h2 class="section-title">Admin Dashboard</h2>
    <div class="card">
        <h3><i class="fas fa-users"></i> All Users</h3>
        <div id="usersList"></div>
    </div>
    <div class="card">
        <h3><i class="fas fa-chart-bar"></i> Platform Statistics</h3>
        <div id="adminStats"></div>
    </div>
</div>

<footer>
    <i class="fas fa-copyright"></i> 2026 Habineza Tech Academy - Computer System & Architecture | All Rights Reserved
</footer>

<script>
    // ==================== INITIALIZATION ====================
    window.onload = function() {
        // Populate date dropdowns
        populateDateDropdowns();
        
        // Load notes and exams
        loadNotes();
        loadExams();
        
        // Initialize default admin
        initDefaultAdmin();
        
        // Check if user is logged in
        let user = getCurrentUser();
        if (user) {
            loadProfile();
            checkAdminAccess();
        }
    };

    // ==================== DATA STORAGE ====================
    function getUsers() {
        return JSON.parse(localStorage.getItem('users')) || [];
    }

    function saveUsers(users) {
        localStorage.setItem('users', JSON.stringify(users));
    }

    function getCurrentUser() {
        return JSON.parse(localStorage.getItem('currentUser'));
    }

    // Simple hash (for demo only)
    function hashPassword(password) {
        return btoa(password);
    }

    // ==================== INITIALIZE DEFAULT ADMIN ====================
    function initDefaultAdmin() {
        let users = getUsers();
        if (!users.some(u => u.email === "admin@habineza.com")) {
            users.push({
                email: "admin@habineza.com",
                password: hashPassword("Admin123"),
                role: "admin",
                course: "All",
                dob: "1990-01-01",
                verified: true,
                completedNotes: [],
                examHistory: [],
                profilePic: null,
                createdAt: new Date().toISOString()
            });
            saveUsers(users);
        }
    }

    // ==================== POPULATE DATE DROPDOWNS ====================
    function populateDateDropdowns() {
        // Days
        let daySelect = document.getElementById('regDay');
        for (let i = 1; i <= 31; i++) {
            let option = document.createElement('option');
            option.value = i.toString().padStart(2, '0');
            option.text = i;
            daySelect.appendChild(option);
        }

        // Years (1950-2010)
        let yearSelect = document.getElementById('regYear');
        let currentYear = new Date().getFullYear();
        for (let i = currentYear - 16; i >= 1950; i--) {
            let option = document.createElement('option');
            option.value = i;
            option.text = i;
            yearSelect.appendChild(option);
        }
    }

    // ==================== TOGGLE PASSWORD VISIBILITY ====================
    function togglePassword(inputId, icon) {
        let input = document.getElementById(inputId);
        if (input.type === "password") {
            input.type = "text";
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = "password";
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    // ==================== SHOW/HIDE FORMS ====================
    function showRegisterForm() {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registerForm').style.display = 'block';
        document.getElementById('verificationForm').style.display = 'none';
    }

    function showLoginForm() {
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('verificationForm').style.display = 'none';
    }

    // ==================== REGISTRATION VARIABLES ====================
    let pendingRegistration = null;
    let verificationCode = null;
    let verificationTimer = null;
    let timeLeft = 300;

    // ==================== SEND VERIFICATION CODE ====================
    function sendVerificationCode() {
        const email = document.getElementById('regEmail').value.trim();
        const password = document.getElementById('regPassword').value;
        const confirmPass = document.getElementById('regConfirmPassword').value;
        const month = document.getElementById('regMonth').value;
        const day = document.getElementById('regDay').value;
        const year = document.getElementById('regYear').value;
        const course = document.getElementById('regCourse').value;

        if (!email || !password || !confirmPass || !month || !day || !year || !course) {
            alert("Please fill in all fields!");
            return;
        }

        if (password.length < 8) {
            alert("Password must be at least 8 characters!");
            return;
        }

        if (password !== confirmPass) {
            alert("Passwords do not match!");
            return;
        }

        if (!email.includes('@') || !email.includes('.')) {
            alert("Please enter a valid email!");
            return;
        }

        let users = getUsers();
        if (users.some(u => u.email === email)) {
            alert("Email already registered!");
            return;
        }

        verificationCode = Math.floor(100000 + Math.random() * 900000).toString();

        pendingRegistration = {
            email: email,
            password: hashPassword(password),
            course: course,
            dob: `${year}-${month}-${day}`,
            role: 'user',
            verified: false,
            completedNotes: [],
            examHistory: [],
            profilePic: null,
            createdAt: new Date().toISOString()
        };

        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('verificationForm').style.display = 'block';
        document.getElementById('verificationEmail').textContent = email;

        startVerificationTimer();
        alert(`[DEMO] Your verification code is: ${verificationCode}`);
    }

    function startVerificationTimer() {
        timeLeft = 300;
        updateTimerDisplay();

        if (verificationTimer) clearInterval(verificationTimer);

        verificationTimer = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();

            if (timeLeft <= 0) {
                clearInterval(verificationTimer);
                document.getElementById('verificationTimer').innerHTML = "Code expired! Please request new one.";
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        let minutes = Math.floor(timeLeft / 60);
        let seconds = timeLeft % 60;
        document.getElementById('verificationTimer').innerHTML = 
            `Time left: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function verifyAndRegister() {
        const code = document.getElementById('verificationCode').value.trim();

        if (!code) {
            alert("Please enter verification code!");
            return;
        }

        if (code !== verificationCode) {
            alert("Invalid verification code!");
            return;
        }

        if (timeLeft <= 0) {
            alert("Code expired! Please request new one.");
            return;
        }

        pendingRegistration.verified = true;
        let users = getUsers();
        users.push(pendingRegistration);
        saveUsers(users);

        clearInterval(verificationTimer);
        alert("Registration successful! You can now login.");

        showLoginForm();
        
        document.getElementById('regEmail').value = '';
        document.getElementById('regPassword').value = '';
        document.getElementById('regConfirmPassword').value = '';
    }

    function resendCode() {
        if (pendingRegistration) {
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            alert(`[DEMO] New verification code: ${verificationCode}`);
            startVerificationTimer();
        }
    }

    // ==================== LOGIN ====================
    function login() {
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;

        if (!email || !password) {
            alert("Please enter email and password!");
            return;
        }

        let users = getUsers();
        const hashedPassword = hashPassword(password);
        const user = users.find(u => u.email === email && u.password === hashedPassword);

        if (user) {
            if (!user.verified) {
                alert("Please verify your email first!");
                return;
            }

            localStorage.setItem('currentUser', JSON.stringify(user));
            alert("Login successful!");
            
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            
            showSection('home');
            loadProfile();
            checkAdminAccess();
            updateHomeProgress();
        } else {
            alert("Incorrect email or password!");
        }
    }

    // ==================== LOGOUT ====================
    function logout() {
        localStorage.removeItem('currentUser');
        alert("Logged out!");
        showSection('login');
        document.getElementById('adminNavLink').style.display = 'none';
    }

    // ==================== CHECK ADMIN ====================
    function isAdmin() {
        let user = getCurrentUser();
        return user && user.role === 'admin';
    }

    function checkAdminAccess() {
        if (isAdmin()) {
            document.getElementById('adminNavLink').style.display = 'inline';
        } else {
            document.getElementById('adminNavLink').style.display = 'none';
        }
    }

    // ==================== SHOW SECTION ====================
    function showSection(id) {
        // Hide all containers
        document.querySelectorAll('.container').forEach(div => {
            div.style.display = 'none';
        });
        
        // Show selected container
        document.getElementById(id).style.display = 'block';
        
        // Load data based on section
        if (id === 'notes') {
            loadNotes();
        }
        if (id === 'exam') {
            loadExams();
        }
        if (id === 'profileSection') {
            loadProfile();
        }
        if (id === 'adminSection' && isAdmin()) {
            loadAdminDashboard();
        }
        if (id === 'home') {
            updateHomeProgress();
        }
    }

    // ==================== NOTES DATA ====================
    const notesData = [
        // C++ Notes
        {
            id: 'cpp1',
            title: "C++ Programming Fundamentals",
            topic: "C++",
            content: `C++ PROGRAMMING BASICS

1. Introduction to C++
   • Object-Oriented Programming
   • Classes and Objects
   • Inheritance and Polymorphism
   • Encapsulation and Abstraction

2. Basic Syntax
   #include <iostream>
   using namespace std;
   
   int main() {
       cout << "Hello, World!";
       return 0;
   }

3. Data Types
   • int (4 bytes)
   • float (4 bytes)
   • double (8 bytes)
   • char (1 byte)
   • bool (1 byte)

4. Control Structures
   • if-else statements
   • switch case
   • for loops
   • while loops
   • do-while loops

5. Functions
   • Function declaration
   • Function definition
   • Function parameters
   • Return values
   • Function overloading`
        },
        {
            id: 'cpp2',
            title: "C++ Object-Oriented Programming",
            topic: "C++",
            content: `C++ OBJECT-ORIENTED PROGRAMMING

1. Classes and Objects
   class Car {
   private:
       string brand;
       int year;
   public:
       Car(string b, int y) {
           brand = b;
           year = y;
       }
       void display() {
           cout << brand << " - " << year;
       }
   };

2. Inheritance
   class Vehicle {
   protected:
       int speed;
   public:
       void setSpeed(int s) { speed = s; }
   };
   
   class Bike : public Vehicle {
   public:
       void showSpeed() {
           cout << "Speed: " << speed;
       }
   };

3. Polymorphism
   • Virtual functions
   • Function overloading
   • Operator overloading

4. Encapsulation
   • Private members
   • Public methods
   • Getters and setters

5. Abstraction
   • Abstract classes
   • Pure virtual functions
   • Interfaces`
        },
        {
            id: 'cpp3',
            title: "Advanced C++ Concepts",
            topic: "C++",
            content: `ADVANCED C++ CONCEPTS

1. Templates
   template <typename T>
   T max(T a, T b) {
       return (a > b) ? a : b;
   }

2. Exception Handling
   try {
       // code
   } catch (exception& e) {
       cout << e.what();
   }

3. STL (Standard Template Library)
   • Vectors
   • Lists
   • Maps
   • Algorithms

4. Smart Pointers
   • unique_ptr
   • shared_ptr
   • weak_ptr

5. Multithreading
   #include <thread>
   void function() {
       // thread work
   }
   thread t(function);
   t.join();`
        },

        // Firmware Notes
        {
            id: 'firm1',
            title: "Firmware Development Basics",
            topic: "Firmware",
            content: `FIRMWARE DEVELOPMENT BASICS

1. What is Firmware?
   • Low-level software
   • Embedded in hardware
   • Controls device operations
   • Stored in ROM/Flash

2. Embedded Systems
   • Microcontrollers
   • Microprocessors
   • Memory types
   • I/O interfaces

3. Bare-Metal Programming
   #include <avr/io.h>
   
   int main(void) {
       DDRB |= (1 << PB0);  // Set PB0 as output
       while(1) {
           PORTB ^= (1 << PB0);  // Toggle LED
           _delay_ms(1000);
       }
   }

4. Interrupt Handling
   ISR(TIMER1_OVF_vect) {
       // Interrupt service routine
   }

5. Memory Management
   • Stack vs Heap
   • Static allocation
   • Dynamic allocation
   • Memory-mapped I/O`
        },
        {
            id: 'firm2',
            title: "Microcontroller Programming",
            topic: "Firmware",
            content: `MICROCONTROLLER PROGRAMMING

1. Popular Microcontrollers
   • Arduino (AVR)
   • STM32 (ARM)
   • ESP32
   • PIC

2. GPIO Programming
   // Arduino Example
   void setup() {
       pinMode(13, OUTPUT);
   }
   
   void loop() {
       digitalWrite(13, HIGH);
       delay(1000);
       digitalWrite(13, LOW);
       delay(1000);
   }

3. Communication Protocols
   • UART
   • I2C
   • SPI
   • CAN Bus

4. Timers and Counters
   // Timer configuration
   TCCR1B |= (1 << CS12);  // Prescaler 256
   TIMSK1 |= (1 << TOIE1); // Enable overflow interrupt

5. ADC Conversion
   analogRead(A0);
   // Convert analog to digital`
        },
        {
            id: 'firm3',
            title: "Real-Time Operating Systems (RTOS)",
            topic: "Firmware",
            content: `REAL-TIME OPERATING SYSTEMS

1. RTOS Concepts
   • Tasks
   • Scheduling
   • Semaphores
   • Queues
   • Mutexes

2. FreeRTOS Example
   void Task1(void *pvParameters) {
       while(1) {
           vTaskDelay(1000 / portTICK_PERIOD_MS);
       }
   }
   
   void setup() {
       xTaskCreate(
           Task1,
           "Task 1",
           100,
           NULL,
           1,
           NULL
       );
       vTaskStartScheduler();
   }

3. Task Scheduling
   • Round Robin
   • Priority-based
   • Preemptive
   • Cooperative

4. Inter-Task Communication
   • Queues
   • Semaphores
   • Mutexes
   • Event groups

5. Timing Constraints
   • Hard real-time
   • Soft real-time
   • Worst-case execution time`
        },

        // Computer Refurbishment Notes
        {
            id: 'ref1',
            title: "Computer Refurbishment Process",
            topic: "Refurbishment",
            content: `COMPUTER REFURBISHMENT PROCESS

1. Assessment Phase
   • Visual inspection
   • Hardware testing
   • Performance evaluation
   • Cost analysis

2. Cleaning and Preparation
   • Dust removal
   • Thermal paste replacement
   • Connector cleaning
   • Case restoration

3. Hardware Testing
   • Power supply test
   • Memory test (MemTest86)
   • Hard drive diagnostics
   • CPU stress test
   • GPU benchmark

4. Component Replacement
   • Failed parts identification
   • Compatible replacements
   • Installation procedures
   • Quality verification

5. Software Installation
   • Operating system setup
   • Driver installation
   • Security updates
   • Essential software`
        },
        {
            id: 'ref2',
            title: "Hardware Diagnostics Tools",
            topic: "Refurbishment",
            content: `HARDWARE DIAGNOSTICS TOOLS

1. Memory Testing
   • MemTest86
   • Windows Memory Diagnostic
   • GoldMemory

2. Hard Drive Testing
   • CrystalDiskInfo (S.M.A.R.T)
   • HD Tune
   • Victoria
   • SeaTools

3. CPU Testing
   • Prime95
   • IntelBurn Test
   • CPU-Z
   • Core Temp

4. GPU Testing
   • FurMark
   • 3DMark
   • GPU-Z
   • MSI Afterburner

5. Power Supply Testing
   • Multimeter
   • Power supply tester
   • Load tester
   • Voltage monitoring

6. Network Testing
   • Ping tests
   • Speed tests
   • Packet loss analysis
   • WiFi analyzer`
        },
        {
            id: 'ref3',
            title: "Refurbishment Business Guide",
            topic: "Refurbishment",
            content: `REFURBISHMENT BUSINESS GUIDE

1. Business Setup
   • Workshop requirements
   • Tools and equipment
   • Inventory management
   • Legal requirements

2. Sourcing Computers
   • Business leases
   • Government auctions
   • Corporate upgrades
   • Donation programs

3. Refurbishment Workflow
   Receiving → Testing → Cleaning → 
   Repair → Testing → Software → 
   Quality Control → Packaging

4. Quality Standards
   • Visual grade (A, B, C)
   • Performance grade
   • Warranty terms
   • Certification

5. Pricing Strategy
   • Cost calculation
   • Market research
   • Value addition
   • Profit margins

6. Sales Channels
   • Online marketplaces
   • Local stores
   • B2B sales
   • Export markets`
        },

        // C Programming Notes
        {
            id: 'c1',
            title: "C Programming Fundamentals",
            topic: "C",
            content: `C PROGRAMMING BASICS

1. Introduction to C
   • Developed by Dennis Ritchie
   • Procedural language
   • System programming
   • Embedded systems

2. Basic Structure
   #include <stdio.h>
   
   int main() {
       printf("Hello, World!");
       return 0;
   }

3. Data Types
   • int (2/4 bytes)
   • float (4 bytes)
   • double (8 bytes)
   • char (1 byte)
   • void

4. Operators
   • Arithmetic (+, -, *, /, %)
   • Relational (<, >, <=, >=, ==, !=)
   • Logical (&&, ||, !)
   • Bitwise (&, |, ^, ~, <<, >>)
   • Assignment (=, +=, -=, etc.)

5. Control Flow
   if (condition) {
       // code
   } else if (condition) {
       // code
   } else {
       // code
   }

   switch(variable) {
       case 1:
           // code
           break;
       default:
           // code
   }`
        },
        {
            id: 'c2',
            title: "Pointers and Memory in C",
            topic: "C",
            content: `POINTERS AND MEMORY MANAGEMENT

1. Pointers Basics
   int x = 10;
   int *ptr = &x;
   printf("%d", *ptr);  // Dereferencing

2. Pointer Arithmetic
   int arr[5] = {1,2,3,4,5};
   int *p = arr;
   p++;  // Move to next element

3. Dynamic Memory Allocation
   #include <stdlib.h>
   
   int *arr = (int*)malloc(5 * sizeof(int));
   if (arr != NULL) {
       // Use memory
       free(arr);  // Don't forget to free!
   }

4. Arrays and Pointers
   char str[] = "Hello";
   char *ptr = str;
   
   while(*ptr != '\0') {
       printf("%c", *ptr);
       ptr++;
   }

5. Function Pointers
   int add(int a, int b) {
       return a + b;
   }
   
   int (*funcPtr)(int,int) = &add;
   int result = funcPtr(5,3);`
        },
        {
            id: 'c3',
            title: "File Handling in C",
            topic: "C",
            content: `FILE HANDLING IN C

1. File Operations
   FILE *fp;
   fp = fopen("file.txt", "r");
   
   if (fp == NULL) {
       printf("Error opening file");
       return;
   }

2. Reading from Files
   // Character by character
   char ch;
   while((ch = fgetc(fp)) != EOF) {
       printf("%c", ch);
   }
   
   // Line by line
   char buffer[255];
   while(fgets(buffer, 255, fp) != NULL) {
       printf("%s", buffer);
   }

3. Writing to Files
   fp = fopen("output.txt", "w");
   fprintf(fp, "Writing to file");
   fputs("Another line", fp);
   fclose(fp);

4. Binary Files
   typedef struct {
       int id;
       char name[50];
   } Record;
   
   Record rec = {1, "John"};
   fwrite(&rec, sizeof(Record), 1, fp);

5. File Positioning
   fseek(fp, 0, SEEK_END);  // Go to end
   long size = ftell(fp);    // Get file size
   rewind(fp);               // Go to beginning`
        },

        // Computer Architecture Notes
        {
            id: 'arch1',
            title: "Computer Architecture Fundamentals",
            topic: "Architecture",
            content: `COMPUTER ARCHITECTURE BASICS

1. Von Neumann Architecture
   • CPU
   • Memory
   • Input/Output
   • Bus system

2. CPU Components
   • Control Unit
   • ALU (Arithmetic Logic Unit)
   • Registers
   • Cache memory

3. Memory Hierarchy
   • Registers (fastest)
   • L1 Cache
   • L2 Cache
   • L3 Cache
   • RAM
   • SSD/HDD (slowest)

4. Instruction Cycle
   • Fetch
   • Decode
   • Execute
   • Store

5. Addressing Modes
   • Immediate
   • Direct
   • Indirect
   • Register
   • Indexed`
        },
        {
            id: 'arch2',
            title: "Processor Design",
            topic: "Architecture",
            content: `PROCESSOR DESIGN

1. RISC vs CISC
   RISC (Reduced Instruction Set)
   • Simple instructions
   • Fixed length
   • Load/store architecture
   • Examples: ARM, MIPS
   
   CISC (Complex Instruction Set)
   • Complex instructions
   • Variable length
   • Memory operations
   • Examples: x86, 68000

2. Pipelining
   Stage 1: Instruction Fetch
   Stage 2: Instruction Decode
   Stage 3: Execute
   Stage 4: Memory Access
   Stage 5: Write Back

3. Superscalar Processors
   • Multiple instruction issue
   • Parallel execution
   • Out-of-order execution
   • Speculative execution

4. Cache Design
   • Direct mapped
   • Set associative
   • Fully associative
   • Write policies

5. Multi-core Processors
   • Symmetric multiprocessing
   • Cache coherence
   • Memory consistency
   • Thread-level parallelism`
        }
    ];

    // ==================== EXAMS DATA ====================
    const examsData = [
        // C++ Exams
        {
            id: 'exam_cpp1',
            title: "C++ Programming Basics",
            topic: "C++",
            time: 900,
            questions: [
                {
                    q: "What is the correct way to create a class in C++?",
                    options: [
                        "class MyClass { };",
                        "Class MyClass { };",
                        "create class MyClass { }",
                        "new class MyClass { }"
                    ],
                    answer: 0
                },
                {
                    q: "Which operator is used for dynamic memory allocation in C++?",
                    options: [
                        "new",
                        "malloc",
                        "alloc",
                        "create"
                    ],
                    answer: 0
                },
                {
                    q: "What is inheritance in C++?",
                    options: [
                        "Creating new classes from existing classes",
                        "Creating multiple objects",
                        "Deleting classes",
                        "Copying classes"
                    ],
                    answer: 0
                },
                {
                    q: "Which header file is needed for input/output operations in C++?",
                    options: [
                        "#include <iostream>",
                        "#include <stdio.h>",
                        "#include <conio.h>",
                        "#include <stdlib.h>"
                    ],
                    answer: 0
                },
                {
                    q: "What is a virtual function?",
                    options: [
                        "A function that can be overridden in derived classes",
                        "A function that doesn't exist",
                        "A static function",
                        "A private function"
                    ],
                    answer: 0
                }
            ]
        },
        {
            id: 'exam_cpp2',
            title: "Advanced C++ Concepts",
            topic: "C++",
            time: 1200,
            questions: [
                {
                    q: "What is a template in C++?",
                    options: [
                        "A blueprint for creating generic functions/classes",
                        "A special type of class",
                        "A memory template",
                        "A design pattern"
                    ],
                    answer: 0
                },
                {
                    q: "Which keyword is used for exception handling?",
                    options: [
                        "try",
                        "catch",
                        "throw",
                        "All of the above"
                    ],
                    answer: 3
                },
                {
                    q: "What is RAII?",
                    options: [
                        "Resource Acquisition Is Initialization",
                        "Random Access Interface Implementation",
                        "Runtime Application Integration Interface",
                        "Rapid Application Implementation"
                    ],
                    answer: 0
                }
            ]
        },

        // Firmware Exams
        {
            id: 'exam_firm1',
            title: "Firmware Development",
            topic: "Firmware",
            time: 900,
            questions: [
                {
                    q: "What is firmware?",
                    options: [
                        "Software embedded in hardware",
                        "Operating system",
                        "Application software",
                        "Database software"
                    ],
                    answer: 0
                },
                {
                    q: "Which is an example of a microcontroller?",
                    options: [
                        "Arduino Uno",
                        "Intel i7",
                        "Ryzen 9",
                        "NVIDIA GPU"
                    ],
                    answer: 0
                },
                {
                    q: "What does ISR stand for?",
                    options: [
                        "Interrupt Service Routine",
                        "Instruction Set Register",
                        "Internal System Reset",
                        "Interface Status Report"
                    ],
                    answer: 0
                }
            ]
        },
        {
            id: 'exam_firm2',
            title: "Embedded Systems",
            topic: "Firmware",
            time: 1200,
            questions: [
                {
                    q: "Which communication protocol uses SDA and SCL lines?",
                    options: [
                        "I2C",
                        "SPI",
                        "UART",
                        "CAN"
                    ],
                    answer: 0
                },
                {
                    q: "What is an RTOS?",
                    options: [
                        "Real-Time Operating System",
                        "Rapid Transfer Operating System",
                        "Remote Task Operating System",
                        "Runtime Operating System"
                    ],
                    answer: 0
                }
            ]
        },

        // Refurbishment Exams
        {
            id: 'exam_ref1',
            title: "Computer Refurbishment",
            topic: "Refurbishment",
            time: 900,
            questions: [
                {
                    q: "What is the first step in refurbishment?",
                    options: [
                        "Assessment and testing",
                        "Cleaning",
                        "Selling",
                        "Packaging"
                    ],
                    answer: 0
                },
                {
                    q: "Which tool is used for memory testing?",
                    options: [
                        "MemTest86",
                        "CPU-Z",
                        "GPU-Z",
                        "CrystalDiskInfo"
                    ],
                    answer: 0
                },
                {
                    q: "What does S.M.A.R.T stand for?",
                    options: [
                        "Self-Monitoring, Analysis and Reporting Technology",
                        "System Management and Recovery Tool",
                        "Smart Memory Access Routine Technology",
                        "Storage Management and Recovery Test"
                    ],
                    answer: 0
                }
            ]
        },

        // C Programming Exams
        {
            id: 'exam_c1',
            title: "C Programming Basics",
            topic: "C",
            time: 900,
            questions: [
                {
                    q: "Which function is used to print output in C?",
                    options: [
                        "printf()",
                        "cout <<",
                        "print()",
                        "console.log()"
                    ],
                    answer: 0
                },
                {
                    q: "What is a pointer in C?",
                    options: [
                        "A variable that stores memory address",
                        "A special integer",
                        "A function",
                        "An array"
                    ],
                    answer: 0
                },
                {
                    q: "Which function allocates memory dynamically?",
                    options: [
                        "malloc()",
                        "alloc()",
                        "new()",
                        "create()"
                    ],
                    answer: 0
                }
            ]
        },
        {
            id: 'exam_c2',
            title: "Advanced C Programming",
            topic: "C",
            time: 1200,
            questions: [
                {
                    q: "What is the size of int pointer on 32-bit system?",
                    options: [
                        "4 bytes",
                        "2 bytes",
                        "8 bytes",
                        "1 byte"
                    ],
                    answer: 0
                },
                {
                    q: "Which file mode opens a file for reading?",
                    options: [
                        "r",
                        "w",
                        "a",
                        "x"
                    ],
                    answer: 0
                }
            ]
        },

        // Computer Architecture Exams
        {
            id: 'exam_arch1',
            title: "Computer Architecture",
            topic: "Architecture",
            time: 900,
            questions: [
                {
                    q: "What is the von Neumann architecture?",
                    options: [
                        "Stored-program computer architecture",
                        "Parallel processing architecture",
                        "Quantum computer architecture",
                        "Neural network architecture"
                    ],
                    answer: 0
                },
                {
                    q: "Which is the fastest memory?",
                    options: [
                        "CPU Registers",
                        "RAM",
                        "SSD",
                        "HDD"
                    ],
                    answer: 0
                },
                {
                    q: "What does ALU stand for?",
                    options: [
                        "Arithmetic Logic Unit",
                        "Advanced Logic Unit",
                        "Application Logic Unit",
                        "Array Logic Unit"
                    ],
                    answer: 0
                }
            ]
        }
    ];

    // ==================== LOAD NOTES ====================
    let currentFilter = 'all';
    let searchTerm = '';

    function loadNotes() {
        const container = document.getElementById('notesContainer');
        container.innerHTML = '';

        let filteredNotes = notesData;

        // Apply topic filter
        if (currentFilter !== 'all') {
            filteredNotes = filteredNotes.filter(note => note.topic === currentFilter);
        }

        // Apply search filter
        if (searchTerm) {
            filteredNotes = filteredNotes.filter(note => 
                note.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                note.content.toLowerCase().includes(searchTerm.toLowerCase())
            );
        }

        if (filteredNotes.length === 0) {
            container.innerHTML = '<div class="card"><p>No notes found matching your criteria.</p></div>';
            return;
        }

        filteredNotes.forEach(note => {
            const noteCard = document.createElement('div');
            noteCard.className = 'card';
            noteCard.innerHTML = `
                <h3><i class="fas fa-book-open"></i> ${note.title}</h3>
                <p style="color: #666; margin: 10px 0;">
                    <span class="topic-tag">${note.topic}</span>
                </p>
                <pre style="background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 10px; white-space: pre-wrap; font-family: 'Courier New', monospace;">${note.content}</pre>
                <button class="btn" onclick="completeNote('${note.title}')">
                    <i class="fas fa-check-circle"></i> Mark as Completed
                </button>
            `;
            container.appendChild(noteCard);
        });
    }

    function filterNotes(topic) {
        currentFilter = topic;
        loadNotes();
    }

    function searchNotes() {
        searchTerm = document.getElementById('noteSearch').value;
        loadNotes();
    }

    // ==================== COMPLETE NOTE ====================
    function completeNote(title) {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            showSection('login');
            return;
        }

        if (!user.completedNotes) {
            user.completedNotes = [];
        }

        if (!user.completedNotes.includes(title)) {
            user.completedNotes.push(title);
            
            let users = getUsers();
            let index = users.findIndex(u => u.email === user.email);
            if (index !== -1) {
                users[index] = user;
                saveUsers(users);
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
            
            alert("Note marked as completed!");
            loadProfile();
            updateHomeProgress();
        } else {
            alert("You already completed this note!");
        }
    }

    // ==================== LOAD EXAMS ====================
    let examFilter = 'all';

    function loadExams() {
        const container = document.getElementById('examContainer');
        container.innerHTML = '';

        let filteredExams = examsData;

        if (examFilter !== 'all') {
            filteredExams = filteredExams.filter(exam => exam.topic === examFilter);
        }

        if (filteredExams.length === 0) {
            container.innerHTML = '<div class="card"><p>No exams found matching your criteria.</p></div>';
            return;
        }

        filteredExams.forEach((exam, index) => {
            const examCard = document.createElement('div');
            examCard.className = 'card';
            examCard.innerHTML = `
                <h3><i class="fas fa-pencil-alt"></i> ${exam.title}</h3>
                <p style="color: #666; margin: 10px 0;">
                    <span class="topic-tag">${exam.topic}</span>
                </p>
                <p>Questions: ${exam.questions.length} | Time: ${Math.floor(exam.time/60)} minutes</p>
                <button class="btn btn-success" onclick="startExam(${examsData.indexOf(exam)})">
                    <i class="fas fa-play"></i> Start Exam
                </button>
            `;
            container.appendChild(examCard);
        });
    }

    function filterExams(topic) {
        examFilter = topic;
        loadExams();
    }

    // ==================== START EXAM ====================
    let currentExamIndex = 0;
    let examTimer = null;
    let examTimeLeft = 0;
    let userAnswers = [];

    function startExam(index) {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            showSection('login');
            return;
        }

        currentExamIndex = index;
        const exam = examsData[index];
        
        // Reset answers
        userAnswers = new Array(exam.questions.length).fill(null);
        
        // Build exam HTML
        let examHTML = `
            <div class="card">
                <h3>${exam.title}</h3>
                <div class="exam-timer" id="examTimer">Time left: ${Math.floor(exam.time/60)}:00</div>
                <form id="examForm">
        `;
        
        exam.questions.forEach((q, qIndex) => {
            examHTML += `
                <div style="margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 10px;">
                    <p><strong>${qIndex + 1}. ${q.q}</strong></p>
            `;
            
            q.options.forEach((opt, optIndex) => {
                examHTML += `
                    <label style="display: block; margin: 10px 0;">
                        <input type="radio" name="q${qIndex}" value="${optIndex}" onchange="saveAnswer(${qIndex}, ${optIndex})">
                        ${opt}
                    </label>
                `;
            });
            
            examHTML += `</div>`;
        });
        
        examHTML += `
                </form>
                <button class="btn btn-success" onclick="submitExam()">Submit Exam</button>
                <button class="btn btn-danger" onclick="loadExams()">Cancel</button>
            </div>
        `;
        
        document.getElementById('examContainer').innerHTML = examHTML;
        
        // Start timer
        examTimeLeft = exam.time;
        updateExamTimer();
        
        if (examTimer) clearInterval(examTimer);
        examTimer = setInterval(updateExamTimer, 1000);
    }

    function updateExamTimer() {
        examTimeLeft--;
        
        let minutes = Math.floor(examTimeLeft / 60);
        let seconds = examTimeLeft % 60;
        
        document.getElementById('examTimer').innerHTML = 
            `Time left: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (examTimeLeft <= 0) {
            clearInterval(examTimer);
            submitExam();
        }
    }

    function saveAnswer(questionIndex, answerIndex) {
        userAnswers[questionIndex] = answerIndex;
    }

    function submitExam() {
        clearInterval(examTimer);
        
        const exam = examsData[currentExamIndex];
        let score = 0;
        
        exam.questions.forEach((q, index) => {
            if (userAnswers[index] === q.answer) {
                score++;
            }
        });
        
        const percentage = Math.round((score / exam.questions.length) * 100);
        const passed = percentage >= 60;
        
        // Save to user history
        let user = getCurrentUser();
        if (user) {
            if (!user.examHistory) {
                user.examHistory = [];
            }
            
            user.examHistory.push({
                exam: exam.title,
                topic: exam.topic,
                score: percentage,
                passed: passed,
                date: new Date().toLocaleDateString()
            });
            
            let users = getUsers();
            let index = users.findIndex(u => u.email === user.email);
            if (index !== -1) {
                users[index] = user;
                saveUsers(users);
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
        }
        
        // Show result
        alert(`Exam Complete!\nScore: ${percentage}%\n${passed ? 'PASSED!' : 'FAILED'}`);
        
        loadExams();
        loadProfile();
    }

    // ==================== LOAD PROFILE ====================
    function loadProfile() {
        let user = getCurrentUser();
        if (!user) return;
        
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userCourse').textContent = `Specialization: ${user.course}`;
        document.getElementById('userDOB').textContent = `Date of Birth: ${user.dob}`;
        
        if (user.role === 'admin') {
            document.getElementById('userRole').innerHTML = '<span class="admin-badge">Admin</span>';
        } else {
            document.getElementById('userRole').innerHTML = '';
        }
        
        // Completed notes
        let completedHTML = '';
        if (user.completedNotes && user.completedNotes.length > 0) {
            user.completedNotes.forEach(note => {
                completedHTML += `<div class="completed-note"><i class="fas fa-check-circle" style="color: #27ae60;"></i> ${note}</div>`;
            });
        } else {
            completedHTML = '<p>No completed notes yet.</p>';
        }
        document.getElementById('completedNotes').innerHTML = completedHTML;
        
        // Exam history
        let historyHTML = '';
        if (user.examHistory && user.examHistory.length > 0) {
            user.examHistory.forEach(exam => {
                historyHTML += `
                    <div class="exam-history-item">
                        <strong>${exam.exam}</strong><br>
                        Score: ${exam.score}% - ${exam.passed ? 'PASSED' : 'FAILED'}<br>
                        Date: ${exam.date}
                    </div>
                `;
            });
        } else {
            historyHTML = '<p>No exams taken yet.</p>';
        }
        document.getElementById('examHistory').innerHTML = historyHTML;
        
        // Calculate progress
        const totalNotes = notesData.length;
        const completedCount = user.completedNotes ? user.completedNotes.length : 0;
        const progressPercent = Math.round((completedCount / totalNotes) * 100);
        
        document.getElementById('profileProgress').style.width = progressPercent + '%';
        document.getElementById('profileProgressText').textContent = progressPercent + '% Complete';
        
        // Profile picture
        if (user.profilePic) {
            document.getElementById('profilePic').src = user.profilePic;
            document.getElementById('profilePicProfile').src = user.profilePic;
            document.getElementById('profilePicSettings').src = user.profilePic;
        }
    }

    // ==================== UPDATE HOME PROGRESS ====================
    function updateHomeProgress() {
        let user = getCurrentUser();
        if (!user) {
            document.getElementById('homeProgress').innerHTML = '<p>Please login to see your progress.</p>';
            return;
        }
        
        let notesCompleted = user.completedNotes ? user.completedNotes.length : 0;
        let examsTaken = user.examHistory ? user.examHistory.length : 0;
        let totalNotes = notesData.length;
        let progressPercent = Math.round((notesCompleted / totalNotes) * 100);
        
        document.getElementById('overallProgress').style.width = progressPercent + '%';
        document.getElementById('progressText').textContent = progressPercent + '% Complete';
        
        document.getElementById('homeProgress').innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div style="background: #e8f5e9; padding: 15px; border-radius: 10px;">
                    <h3 style="color: #27ae60;">${notesCompleted}</h3>
                    <p>Notes Completed</p>
                </div>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px;">
                    <h3 style="color: #3498db;">${examsTaken}</h3>
                    <p>Exams Taken</p>
                </div>
            </div>
        `;
    }

    // ==================== UPLOAD PROFILE PIC ====================
    function uploadProfilePic(event) {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            return;
        }
        
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            user.profilePic = e.target.result;
            
            let users = getUsers();
            let index = users.findIndex(u => u.email === user.email);
            if (index !== -1) {
                users[index] = user;
                saveUsers(users);
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
            
            document.getElementById('profilePic').src = e.target.result;
            document.getElementById('profilePicProfile').src = e.target.result;
            document.getElementById('profilePicSettings').src = e.target.result;
            
            alert("Profile picture updated!");
        };
        reader.readAsDataURL(file);
    }

    // ==================== CHANGE PASSWORD ====================
    function changePassword() {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            return;
        }
        
        const current = document.getElementById('currentPassword').value;
        const newPass = document.getElementById('newPassword').value;
        const confirm = document.getElementById('confirmNewPassword').value;
        
        if (!current || !newPass || !confirm) {
            alert("Please fill in all fields!");
            return;
        }
        
        if (hashPassword(current) !== user.password) {
            alert("Current password is incorrect!");
            return;
        }
        
        if (newPass.length < 8) {
            alert("New password must be at least 8 characters!");
            return;
        }
        
        if (newPass !== confirm) {
            alert("New passwords do not match!");
            return;
        }
        
        user.password = hashPassword(newPass);
        
        let users = getUsers();
        let index = users.findIndex(u => u.email === user.email);
        if (index !== -1) {
            users[index] = user;
            saveUsers(users);
            localStorage.setItem('currentUser', JSON.stringify(user));
        }
        
        alert("Password updated successfully!");
        
        document.getElementById('currentPassword').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmNewPassword').value = '';
    }

    // ==================== CLEAR ALL DATA ====================
    function clearAllData() {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            return;
        }
        
        if (confirm("Are you sure you want to clear all your progress? This cannot be undone!")) {
            user.completedNotes = [];
            user.examHistory = [];
            
            let users = getUsers();
            let index = users.findIndex(u => u.email === user.email);
            if (index !== -1) {
                users[index] = user;
                saveUsers(users);
                localStorage.setItem('currentUser', JSON.stringify(user));
            }
            
            alert("Progress cleared!");
            loadProfile();
            updateHomeProgress();
        }
    }

    // ==================== EXPORT DATA ====================
    function exportData() {
        let user = getCurrentUser();
        if (!user) {
            alert("Please login first!");
            return;
        }
        
        const data = {
            email: user.email,
            course: user.course,
            dob: user.dob,
            role: user.role,
            completedNotes: user.completedNotes || [],
            examHistory: user.examHistory || [],
            exportDate: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `habineza-${user.email}-data.json`;
        a.click();
        
        alert("Data exported successfully!");
    }

    // ==================== LOAD ADMIN DASHBOARD ====================
    function loadAdminDashboard() {
        if (!isAdmin()) return;
        
        const users = getUsers();
        let usersHTML = '';
        
        users.forEach(user => {
            usersHTML += `
                <div class="user-row">
                    <div>
                        <strong>${user.email}</strong>
                        ${user.role === 'admin' ? '<span class="admin-badge">Admin</span>' : ''}
                        <div style="font-size: 12px; color: #666;">
                            Course: ${user.course} | Notes: ${user.completedNotes ? user.completedNotes.length : 0} | Exams: ${user.examHistory ? user.examHistory.length : 0}
                        </div>
                    </div>
                    ${user.role !== 'admin' ? `
                        <div>
                            <button class="btn" style="padding: 5px 10px; font-size: 12px;" onclick="makeAdmin('${user.email}')">Make Admin</button>
                            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteUser('${user.email}')">Delete</button>
                        </div>
                    ` : ''}
                </div>
            `;
        });
        
        document.getElementById('usersList').innerHTML = usersHTML || '<p>No users found.</p>';
        
        // Statistics
        const totalUsers = users.length;
        const totalAdmins = users.filter(u => u.role === 'admin').length;
        const totalNotes = users.reduce((sum, u) => sum + (u.completedNotes ? u.completedNotes.length : 0), 0);
        const totalExams = users.reduce((sum, u) => sum + (u.examHistory ? u.examHistory.length : 0), 0);
        
        document.getElementById('adminStats').innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="color: #3498db;">${totalUsers}</h3>
                    <p>Total Users</p>
                </div>
                <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="color: #e74c3c;">${totalAdmins}</h3>
                    <p>Admins</p>
                </div>
                <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="color: #27ae60;">${totalNotes}</h3>
                    <p>Notes Completed</p>
                </div>
                <div style="text-align: center; padding: 15px; background: #f5f5f5; border-radius: 10px;">
                    <h3 style="color: #f39c12;">${totalExams}</h3>
                    <p>Exams Taken</p>
                </div>
            </div>
        `;
    }

    // ==================== MAKE ADMIN ====================
    function makeAdmin(email) {
        if (!isAdmin()) return;
        
        if (confirm(`Make ${email} an admin?`)) {
            let users = getUsers();
            let user = users.find(u => u.email === email);
            if (user) {
                user.role = 'admin';
                saveUsers(users);
                loadAdminDashboard();
                alert(`${email} is now an admin!`);
            }
        }
    }

    // ==================== DELETE USER ====================
    function deleteUser(email) {
        if (!isAdmin()) return;
        
        if (confirm(`Delete user ${email}? This cannot be undone!`)) {
            let users = getUsers();
            users = users.filter(u => u.email !== email);
            saveUsers(users);
            
            // If current user is deleted, logout
            let current = getCurrentUser();
            if (current && current.email === email) {
                logout();
            }
            
            loadAdminDashboard();
            alert("User deleted!");
        }
    }
</script>

</body>
</html>
